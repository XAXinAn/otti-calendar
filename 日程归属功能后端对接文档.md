# 📂 日程归属与来源显示功能后端对接文档 (V1.2)

本文档说明了如何实现“个人日程”与“群组日程”的区分存储，并确保前端能准确显示日程的来源名称。

## 1. 数据库变更建议

### 1.1 日程表 (schedules)
新增字段：
*   **`group_id`**: String/UUID，**可空 (Nullable)**。
    *   为 `null` 时：代表个人日程。
    *   不为 `null` 时：代表所属群组日程。

---

## 2. 接口详细规约

### 2.1 获取日程列表 (GET /api/schedules)
这是最重要的接口。用户需要看到“自己的日程”+“所属群组的所有日程”。

*   **后端查询逻辑**:
    1. 获取当前登录用户的 `userId`。
    2. 查询该用户加入的所有群组 ID 列表。
    3. 查询条件：`WHERE (owner_id = {userId} AND group_id IS NULL) OR (group_id IN {userGroupIds})`。
*   **关键：多表关联查询 (JOIN)**:
    为了让前端直接显示来源名称，请在 SQL 中关联 `groups` 表。
    ```sql
    SELECT s.*, g.name as group_name 
    FROM schedules s 
    LEFT JOIN groups g ON s.group_id = g.group_id
    ...
    ```

### 2.2 创建/修改日程 (POST & PUT /api/schedules)
前端会根据用户的选择发送 `groupId`。

*   **请求体 (Body)**:
```json
{
  "title": "项目评审",
  "groupId": "uuid-12345", // 选择个人时传 null
  "..." : "..."
}
```
*   **注意**: 修改日程归属时，后端只需更新 `schedules` 表的 `group_id` 字段即可。

---

## 3. 前端模型字段匹配 (必须对齐)
后端返回的每个日程对象中，**必须**包含以下两个字段：

| 字段名 | 类型 | 说明 |
| :--- | :--- | :--- |
| **`groupId`** | String? | 归属群组ID。若为个人日程则返回 `null`。 |
| **`groupName`** | String? | **归属群组名称**。若为个人日程请返回 `null`（或不返回）。 |

**响应示例 (JSON)**:
```json
[
  {
    "scheduleId": "1",
    "title": "买菜",
    "groupId": null,
    "groupName": null, // 列表将显示“来源: 个人”
    "category": "生活"
  },
  {
    "scheduleId": "2",
    "title": "班级开会",
    "groupId": "group-888",
    "groupName": "A23计算机1班", // 列表将显示“来源: A23计算机1班”
    "category": "学习"
  }
]
```

---

## 4. 业务逻辑提示
1.  **权限校验**: 在修改归属时，后端应校验目标 `groupId` 是否为该用户已加入的群组，防止非法注入。
2.  **解散处理**: 当一个群组被解散时，建议同步删除该群组下的所有 `schedules`。
