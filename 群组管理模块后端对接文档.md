# 👥 OttiCalendar 群组管理模块后端对接文档 (V2.2 技术全量版)

此文档旨在指导后端开发人员实现群组系统的全套功能。前端已按此规约完成开发。

## 1. 全局规约
*   **Base URL**: `http://{server_ip}:8080`
*   **认证**: Header 必须携带 `Authorization: Bearer {JWT_TOKEN}`。
*   **响应结构**: 
    ```json
    {
      "code": 200, // 200表示成功，其他表示失败
      "message": "提示信息",
      "data": {} // 业务数据
    }
    ```

---

## 2. 数据库表结构建议

### 2.1 群组表 (groups)
| 字段名 | 类型 | 必填 | 说明 |
| :--- | :--- | :--- | :--- |
| **`group_id`** | String/UUID | 是 | 主键 |
| **`name`** | String | 是 | 群组名称 |
| **`description`** | String | 否 | 群组简介 |
| **`owner_id`** | String | 是 | 群主的用户ID |
| **`invite_code`** | String | 是 | 唯一6位大写字母数字组合 (索引) |
| **`created_at`** | Long | 是 | 创建时间戳 (ms) |

### 2.2 群组成员关联表 (group_members)
| 字段名 | 类型 | 必填 | 说明 |
| :--- | :--- | :--- | :--- |
| **`group_id`** | String | 是 | 关联 groups.group_id |
| **`user_id`** | String | 是 | 关联 users.user_id |
| **`role`** | String | 是 | `owner`(群主), `admin`(管理员), `member`(成员) |
| **`joined_at`** | Long | 是 | 入群时间戳 (ms) |

---

## 3. 接口详细清单

### 3.1 创建群组
*   **URL**: `POST /api/groups`
*   **请求体**: `{"name": "A23班级群", "description": "日程共享"}`
*   **逻辑**: 
    1. 生成唯一邀请码。
    2. 插入 `groups` 表。
    3. 插入 `group_members` 表，角色设为 `owner`。
*   **成功返回**: `data: {"groupId": "...", "inviteCode": "A7B2X9"}`

### 3.2 加入群组
*   **URL**: `POST /api/groups/join`
*   **请求体**: `{"inviteCode": "A7B2X9"}`
*   **逻辑**: 校验邀请码 -> 插入 `group_members` 角色设为 `member`。

### 3.3 获取我创建的群组列表
*   **URL**: `GET /api/groups/created`
*   **返回**: 数组 `[Group, Group, ...]`
*   **排序**: 按 `created_at` 降序。

### 3.4 获取我加入的群组列表
*   **URL**: `GET /api/groups/joined`
*   **返回**: 数组 `[Group, Group, ...]` (需包含 `currentUserRole` 字段)
*   **排序**: 按 `joined_at` 降序。

### 3.5 获取群组成员列表
*   **URL**: `GET /api/groups/{groupId}/members`
*   **权限**: 仅 `owner` 或 `admin` 可调用。
*   **响应示例**:
    ```json
    "data": [
      {"userId": "1", "username": "张三", "groupRole": "owner", "joinedAt": 1705234567000},
      {"userId": "2", "username": "李四", "groupRole": "admin", "joinedAt": 1705234568000}
    ]
    ```

### 3.6 设置/取消管理员 (群主特权)
*   **URL**: `POST /api/groups/{groupId}/members/{userId}/role`
*   **请求体**: `{"role": "admin"}` 或 `{"role": "member"}`
*   **逻辑**: 校验操作人是否为 `owner` -> 更新成员角色。

### 3.7 解散群组 (群主特权)
*   **URL**: `DELETE /api/groups/{groupId}`
*   **逻辑**: 校验 `owner` -> 删除该群所有关联数据。

### 3.8 退出群组 (管理员及成员可用)
*   **URL**: `POST /api/groups/{groupId}/quit`
*   **逻辑**: 删除当前用户在 `group_members` 的记录。

---

## 4. 前端模型字段匹配表 (必看)
请确保返回的 JSON 字段名如下，否则前端无法解析：
*   `groupId`: 群ID
*   `name`: 群名称
*   `currentUserRole`: 当前查询用户在该群的角色 (`owner`/`admin`/`member`)
*   `inviteCode`: 邀请码 (管理员/群主可见)
*   `memberCount`: 整数，当前成员总数
*   `createdAt` / `joinedAt`: 毫秒时间戳
