# 👥 群成员管理接口对接文档

本文档详细说明了“移除成员”、“设为管理员”、“解除管理员”三个核心功能的后端接口规范。

## 1. 基础规约
*   **认证**: 所有请求必须在 Header 中携带 `Authorization: Bearer {token}`。
*   **响应结构**: 统一使用 `{"code": 200, "message": "...", "data": ...}`。前端通过检查 JSON 中的 `code == 200` 来判断操作是否成功。

---

## 2. 批量移除群成员
该接口用于将一个或多个选中的普通成员或管理员移出群组。

*   **URL**: `DELETE /api/groups/{groupId}/members`
*   **Method**: `DELETE`
*   **请求体 (JSON)**:
    ```json
    {
      "userIds": ["user_id_1", "user_id_2"]
    }
    ```
*   **后端核心逻辑**:
    1. **权限检查**: 校验发起请求的用户是否为该群的 `owner` (群主) 或 `admin` (管理员)。
    2. **互踢逻辑限制**:
        *   `admin` 只能移除角色为 `member` 的人。
        *   `admin` **无权**移除 `owner` 或其他 `admin`。
        *   `owner` 可以移除除自己以外的所有人。
    3. **执行**: 从 `group_members` 表中删除对应记录。

---

## 3. 设置/解除管理员
此接口通过修改成员角色，实现权限的升降。

*   **URL**: `PUT /api/groups/{groupId}/members/{userId}/role`
*   **Method**: `PUT`
*   **请求体 (JSON)**:
    ```json
    {
      "role": "admin" // 设为管理员传 "admin"，解除管理员传 "member"
    }
    ```
*   **后端核心逻辑**:
    1. **权限检查**: **仅限 `owner` (群主) 调用此接口**。管理员和普通成员无权修改他人角色。
    2. **执行**: 更新 `group_members` 表中对应 `userId` 的 `role` 字段。
    3. **返回**: 成功后返回 `code: 200`。

---

## 4. 前端逻辑特别说明
1. **多选删除**: 前端支持长按进入多选模式，勾选多个成员后点击“移除成员”，会一次性发送所有选中的 `userIds`。
2. **状态自动切换**: 前端在“单选”一名成员时，会根据其当前角色动态显示按钮：
    *   若其角色为 `admin` -> 按钮显示“解除管理员”，请求体 `role: "member"`。
    *   若其角色为 `member` -> 按钮显示“添加管理员”，请求体 `role: "admin"`。
3. **即时刷新**: 只有后端返回 `code: 200`，前端才会弹出“操作成功”提示并自动刷新成员列表。
